<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GitNote - ë””ë²„ê·¸</title>
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/header.css" />
    <link rel="stylesheet" href="css/footer.css" />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: "Courier New", monospace;
        background: #1e1e1e;
        color: #d4d4d4;
        padding: 20px;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: #252526;
        border-radius: 8px;
        padding: 40px 20px;
      }
      h1 {
        color: #4ec9b0;
        margin-bottom: 20px;
        border-bottom: 2px solid #4ec9b0;
        padding-bottom: 10px;
      }
      .section {
        background: #1e1e1e;
        border: 1px solid #3e3e42;
        border-radius: 4px;
        padding: 15px;
        margin-bottom: 15px;
      }
      .section h2 {
        color: #dcdcaa;
        font-size: 16px;
        margin-bottom: 10px;
      }
      button {
        background: #0e639c;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        margin-right: 10px;
        margin-bottom: 10px;
        font-family: inherit;
      }
      button:hover {
        background: #1177bb;
      }
      .success {
        color: #4ec9b0;
      }
      .error {
        color: #f48771;
      }
      .warning {
        color: #dcdcaa;
      }
      .info {
        color: #569cd6;
      }
      pre {
        background: #1e1e1e;
        border: 1px solid #3e3e42;
        border-radius: 4px;
        padding: 10px;
        overflow-x: auto;
        margin-top: 10px;
        white-space: pre-wrap;
        word-wrap: break-word;
      }
      .status-dot {
        display: inline-block;
        width: 10px;
        height: 10px;
        border-radius: 50%;
        margin-right: 5px;
      }
      .status-dot.green {
        background: #4ec9b0;
      }
      .status-dot.red {
        background: #f48771;
      }
      .status-dot.yellow {
        background: #dcdcaa;
      }
    </style>
  </head>
  <body>
    <div id="header-container"></div>

    <main>
      <div class="container">
        <h1>ğŸ”§ GitNote ë””ë²„ê·¸ ë„êµ¬</h1>

        <div class="section">
          <h2>1. ì„œë²„ ìƒíƒœ í™•ì¸</h2>
          <button onclick="checkBackendServer()">
            ë°±ì—”ë“œ ì„œë²„ í™•ì¸ (8080)
          </button>
          <button onclick="checkFrontendServer()">
            í”„ë¡ íŠ¸ì—”ë“œ ì„œë²„ í™•ì¸ (5173)
          </button>
          <div id="serverStatus"></div>
        </div>

        <div class="section">
          <h2>2. ì„¸ì…˜ ì •ë³´</h2>
          <button onclick="checkSession()">ì„¸ì…˜ í™•ì¸</button>
          <button onclick="clearSessionStorage()">ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ ì´ˆê¸°í™”</button>
          <div id="sessionInfo"></div>
        </div>

        <div class="section">
          <h2>3. API í…ŒìŠ¤íŠ¸</h2>
          <button onclick="testClientIdAPI()">Client ID API</button>
          <button onclick="testRepositoriesAPI()">Repositories API</button>
          <button onclick="testRateLimitAPI()">Rate Limit API</button>
          <div id="apiTest"></div>
        </div>

        <div class="section">
          <h2>4. ë¸Œë¼ìš°ì € ì½˜ì†” ë¡œê·¸</h2>
          <p class="info">
            F12ë¥¼ ëˆŒëŸ¬ ê°œë°œì ë„êµ¬ë¥¼ ì—´ê³  Console íƒ­ì„ í™•ì¸í•˜ì„¸ìš”.
          </p>
        </div>
      </div>
    </main>

    <div id="footer-container"></div>

    <script src="js/header.js"></script>
    <script src="js/footer.js"></script>
    <script>
      const API_BASE = "http://localhost:8080";

      async function checkBackendServer() {
        const output = document.getElementById("serverStatus");
        output.innerHTML = "<pre>â³ ë°±ì—”ë“œ ì„œë²„ í™•ì¸ ì¤‘...</pre>";

        try {
          const response = await fetch(`${API_BASE}/api/github/client-id`, {
            credentials: "include",
          });

          if (response.ok) {
            const data = await response.json();
            output.innerHTML = `<pre class="success"><span class="status-dot green"></span>âœ… ë°±ì—”ë“œ ì„œë²„ ì‹¤í–‰ ì¤‘ (8080 í¬íŠ¸)
Client ID: ${data.clientId}</pre>`;
          } else {
            output.innerHTML = `<pre class="error"><span class="status-dot red"></span>âŒ ë°±ì—”ë“œ ì‘ë‹µ ì˜¤ë¥˜: ${response.status}</pre>`;
          }
        } catch (error) {
          output.innerHTML = `<pre class="error"><span class="status-dot red"></span>âŒ ë°±ì—”ë“œ ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

ì˜¤ë¥˜: ${error.message}

í•´ê²°ë°©ë²•:
1. í„°ë¯¸ë„ì„ ì—´ê³  ë‹¤ìŒ ëª…ë ¹ì–´ ì‹¤í–‰:
   cd /Users/krystal/workspace/Git_Note/backend
   ./gradlew bootRun

2. ë˜ëŠ”:
   cd /Users/krystal/workspace/Git_Note/backend
   ./gradlew build && java -jar build/libs/backend-0.0.1-SNAPSHOT.jar
</pre>`;
        }
      }

      async function checkFrontendServer() {
        const output = document.getElementById("serverStatus");
        const currentPort = window.location.port;

        if (currentPort === "5173") {
          output.innerHTML = `<pre class="success"><span class="status-dot green"></span>âœ… í”„ë¡ íŠ¸ì—”ë“œ ì„œë²„ ì‹¤í–‰ ì¤‘ (${currentPort} í¬íŠ¸)</pre>`;
        } else if (window.location.protocol === "file:") {
          output.innerHTML = `<pre class="warning"><span class="status-dot yellow"></span>âš ï¸ íŒŒì¼ë¡œ ì§ì ‘ ì—´ì—ˆìŠµë‹ˆë‹¤.

ì„œë²„ë¥¼ í†µí•´ ì ‘ì†í•˜ì„¸ìš”:
1. í„°ë¯¸ë„ì—ì„œ ì‹¤í–‰:
   cd /Users/krystal/workspace/Git_Note/frontend
   python3 -m http.server 5173

2. ë¸Œë¼ìš°ì €ì—ì„œ ì ‘ì†:
   http://localhost:5173
</pre>`;
        } else {
          output.innerHTML = `<pre class="info"><span class="status-dot yellow"></span>â„¹ï¸ í˜„ì¬ í¬íŠ¸: ${
            currentPort || "ì•Œ ìˆ˜ ì—†ìŒ"
          }</pre>`;
        }
      }

      function checkSession() {
        const output = document.getElementById("sessionInfo");
        const username = sessionStorage.getItem("username");
        const avatar = sessionStorage.getItem("avatar");
        const accessToken = sessionStorage.getItem("accessToken");

        if (username) {
          output.innerHTML = `<pre class="success">âœ… ë¡œê·¸ì¸ ìƒíƒœ

Username: ${username}
Avatar: ${avatar ? "ìˆìŒ" : "ì—†ìŒ"}
Access Token: ${
            accessToken
              ? "ìˆìŒ (sessionStorageì— ì €ì¥ë˜ì–´ ìˆìœ¼ë©´ ì•ˆë¨!)"
              : "ì—†ìŒ (ì •ìƒ)"
          }

â€» Access Tokenì€ ì„œë²„ ì„¸ì…˜ì—ë§Œ ì €ì¥ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
</pre>`;
        } else {
          output.innerHTML = `<pre class="warning">âš ï¸ ë¡œê·¸ì¸ë˜ì§€ ì•ŠìŒ

SessionStorageê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.
index.htmlì—ì„œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.
</pre>`;
        }
      }

      function clearSessionStorage() {
        sessionStorage.clear();
        document.getElementById("sessionInfo").innerHTML =
          '<pre class="success">âœ… SessionStorageë¥¼ ì´ˆê¸°í™”í–ˆìŠµë‹ˆë‹¤.</pre>';
      }

      async function testClientIdAPI() {
        const output = document.getElementById("apiTest");
        output.innerHTML = "<pre>â³ í…ŒìŠ¤íŠ¸ ì¤‘...</pre>";

        try {
          const response = await fetch(`${API_BASE}/api/github/client-id`, {
            credentials: "include",
          });
          const data = await response.json();

          output.innerHTML = `<pre class="success">âœ… Client ID API ì •ìƒ

Status: ${response.status}
Response:
${JSON.stringify(data, null, 2)}
</pre>`;
        } catch (error) {
          output.innerHTML = `<pre class="error">âŒ ì‹¤íŒ¨: ${error.message}</pre>`;
        }
      }

      async function testRepositoriesAPI() {
        const output = document.getElementById("apiTest");
        output.innerHTML = "<pre>â³ Repositories API í…ŒìŠ¤íŠ¸ ì¤‘...</pre>";

        try {
          const response = await fetch(`${API_BASE}/api/github/repositories`, {
            credentials: "include",
          });
          const data = await response.json();

          if (response.ok) {
            output.innerHTML = `<pre class="success">âœ… Repositories API ì„±ê³µ

Status: ${response.status}
ë¦¬í¬ì§€í† ë¦¬ ê°œìˆ˜: ${data.count}
Response:
${JSON.stringify(data, null, 2)}
</pre>`;
          } else {
            output.innerHTML = `<pre class="error">âŒ Repositories API ì‹¤íŒ¨

Status: ${response.status}
Error:
${JSON.stringify(data, null, 2)}

${data.needLogin ? "\nâš ï¸ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤!" : ""}
</pre>`;
          }
        } catch (error) {
          output.innerHTML = `<pre class="error">âŒ ì‹¤íŒ¨: ${error.message}

ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš”.
</pre>`;
        }
      }

      async function testRateLimitAPI() {
        const output = document.getElementById("apiTest");
        output.innerHTML = "<pre>â³ Rate Limit í™•ì¸ ì¤‘...</pre>";

        try {
          const response = await fetch(`${API_BASE}/api/github/rate-limit`, {
            credentials: "include",
          });
          const data = await response.json();

          if (response.ok && data.resources) {
            const core = data.resources.core;
            const resetTime = new Date(core.reset * 1000).toLocaleString(
              "ko-KR"
            );

            output.innerHTML = `<pre class="success">âœ… Rate Limit ì •ë³´

ë‚¨ì€ ìš”ì²­: ${core.remaining} / ${core.limit}
ì¬ì„¤ì • ì‹œê°„: ${resetTime}

Full Response:
${JSON.stringify(data, null, 2)}
</pre>`;
          } else {
            output.innerHTML = `<pre class="error">âŒ Rate Limit API ì‹¤íŒ¨

${JSON.stringify(data, null, 2)}
</pre>`;
          }
        } catch (error) {
          output.innerHTML = `<pre class="error">âŒ ì‹¤íŒ¨: ${error.message}</pre>`;
        }
      }

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì²´í¬
      window.addEventListener("DOMContentLoaded", () => {
        checkBackendServer();
        checkSession();
      });
    </script>
  </body>
</html>
