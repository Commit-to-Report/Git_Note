<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GitNote - ë³´ê³ ì„œ ëª©ë¡</title>

    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/header.css" />
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        /* ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ */
        .container {
            width: 100%;
            max-width: 900px;
            margin: 60px auto;
            padding: 40px;
            background: white;
            border-radius: 16px;
            border-top: 5px solid #F55600;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08);
        }

        h2 {
            margin-top: 0;
            margin-bottom: 30px;
            font-size: 26px;
            font-weight: 700;
            color: #333;
            display: flex; align-items: center; gap: 10px;
        }

        /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        .report-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        .report-table th {
            background-color: #fff5f0;
            color: #F55600;
            padding: 16px;
            text-align: left;
            font-weight: 700;
            border-bottom: 2px solid #F55600;
        }

        .report-table td {
            padding: 20px 16px;
            border-bottom: 1px solid #eee;
            vertical-align: middle;
        }

        /* [í•µì‹¬] ì¤„ ì „ì²´ì— ë§ˆìš°ìŠ¤ ì˜¬ë ¸ì„ ë•Œ ìŠ¤íƒ€ì¼ */
        .report-table tbody tr {
            cursor: pointer; /* ì†ê°€ë½ ëª¨ì–‘ ì»¤ì„œ */
            transition: background-color 0.2s;
        }

        /* ë§ˆìš°ìŠ¤ ì˜¬ë¦¬ë©´ íšŒìƒ‰ ë°°ê²½ */
        .report-table tbody tr:hover {
            background-color: #f1f3f5;
        }

        .date-main { font-weight: 600; font-size: 16px; color: #333; }
        .date-sub { font-size: 13px; color: #999; margin-left: 8px; }
        .empty-msg { text-align: center; padding: 50px; color: #888; cursor: default !important; }

        /* í™”ì‚´í‘œ ì•„ì´ì½˜ ìŠ¤íƒ€ì¼ (ë²„íŠ¼ ëŒ€ì‹ ) */
        .arrow-icon {
            color: #ccc;
            font-weight: bold;
            font-size: 18px;
            transition: color 0.2s, transform 0.2s;
        }

        /* ì¤„ì— ë§ˆìš°ìŠ¤ ì˜¬ë¦¬ë©´ í™”ì‚´í‘œê°€ ì˜¤ë Œì§€ìƒ‰ìœ¼ë¡œ ë³€í•˜ê³  ì‚´ì§ ì´ë™ */
        .report-table tbody tr:hover .arrow-icon {
            color: #F55600;
            transform: translateX(5px);
        }

        /* --- íŒì—…(ëª¨ë‹¬) ìŠ¤íƒ€ì¼ --- */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(2px);
        }

        .modal-window {
            background: white;
            width: 90%;
            max-width: 800px;
            max-height: 85vh;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            padding: 20px 24px;
            background: #fff;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title { font-size: 18px; font-weight: 700; color: #333; }

        .close-btn {
            background: none; border: none; font-size: 24px;
            cursor: pointer; color: #888; transition: color 0.2s;
        }
        .close-btn:hover { color: #F55600; }

        .modal-body {
            padding: 30px;
            overflow-y: auto;
            font-size: 15px;
            line-height: 1.6;
            color: #333;
        }

        /* ëª¨ë‹¬ ë‚´ë¶€ ë§ˆí¬ë‹¤ìš´ ìŠ¤íƒ€ì¼ */
        .modal-body h1 { font-size: 24px; border-bottom: 1px solid #eee; padding-bottom: 10px; margin-top: 20px; }
        .modal-body h2 { font-size: 20px; color: #F55600; margin-top: 20px; }
        .modal-body strong { color: #F55600; }
        .modal-body blockquote { background: #fff5f0; border-left: 4px solid #F55600; padding: 10px 20px; margin: 20px 0; color: #555;}
        .modal-body code { background: #f1f3f5; color: #c92a2a; padding: 2px 5px; border-radius: 4px; font-family: monospace; }
        .modal-body p { margin-bottom: 15px; word-break: keep-all; }

    </style>
</head>
<body>

<div id="header-container"></div>

<div class="container">
    <h2>ğŸ“‘ ì „ì²´ë³´ê¸° </h2>
    <table class="report-table" id="reportTable">
        <thead>
        <tr>
            <th width="45%">ë‚ ì§œ</th>
            <th width="35%">ì‚¬ìš©ì</th>
            <th width="20%" style="text-align: center;">ì—´ê¸°</th>
        </tr>
        </thead>
        <tbody>
        <tr><td colspan="3" class="empty-msg">ë°ì´í„° ë¡œë”© ì¤‘...</td></tr>
        </tbody>
    </table>
</div>

<div id="reportModal" class="modal-overlay">
    <div class="modal-window">
        <div class="modal-header">
            <div class="modal-title" id="modalTitle">ğŸ“„ ë³´ê³ ì„œ ìƒì„¸ ë‚´ìš©</div>
            <button class="close-btn" onclick="closeModal()">Ã—</button>
        </div>
        <div class="modal-body markdown-body" id="modalContent"></div>
    </div>
</div>

<script>
    function formatDateTime(isoString) {
        if (!isoString) return { date: '-', time: '' };
        try {
            const dateObj = new Date(isoString);
            const year = dateObj.getFullYear();
            const month = String(dateObj.getMonth() + 1).padStart(2, '0');
            const day = String(dateObj.getDate()).padStart(2, '0');
            const hours = String(dateObj.getHours()).padStart(2, '0');
            const minutes = String(dateObj.getMinutes()).padStart(2, '0');
            return {
                date: `${year}. ${month}. ${day}.`,
                time: `${hours}:${minutes}`
            };
        } catch (e) { return { date: isoString, time: '' }; }
    }

    async function loadReports() {
        const tbody = document.querySelector("#reportTable tbody");
        try {
            const res = await fetch("http://localhost:8080/api/user/report/list");
            if (!res.ok) throw new Error("ì„œë²„ ì˜¤ë¥˜");

            const reports = await res.json();
            tbody.innerHTML = "";

            if (!reports || reports.length === 0) {
                tbody.innerHTML = `<tr><td colspan="3" class="empty-msg">ì €ì¥ëœ ë³´ê³ ì„œê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
                return;
            }

            reports.forEach(report => {
                const tr = document.createElement("tr");
                const dt = formatDateTime(report.SK);

                // ë²„íŠ¼ì„ ì—†ì• ê³  ëŒ€ì‹  ê¹”ë”í•œ í™”ì‚´í‘œ(chevron) ì•„ì´ì½˜ë§Œ ë„£ìŒ
                tr.innerHTML = `
                    <td>
                        <span class="date-main">ğŸ“… ${dt.date}</span>
                        <span class="date-sub">${dt.time}</span>
                    </td>
                    <td>
                        <div style="display:flex; align-items:center; gap:8px;">
                            <span style="background:#eee; padding:4px 8px; border-radius:12px; font-size:12px; font-weight:bold; color:#555;">User</span>
                            <b style="font-size:15px;">${report.User}</b>
                        </div>
                    </td>
                    <td style="text-align: center;">
                        <span class="arrow-icon">â€º</span>
                    </td>
                `;
                tbody.appendChild(tr);

                // [í•µì‹¬ ë³€ê²½] ë²„íŠ¼ì´ ì•„ë‹ˆë¼ 'ì¤„(tr)' ì „ì²´ì— í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
                tr.addEventListener("click", () => {
                    openModal(report);
                });
            });

        } catch (err) {
            console.error(err);
            tbody.innerHTML = `<tr><td colspan="3" class="empty-msg" style="color:red;">ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨</td></tr>`;
        }
    }

    // --- íŒì—… ë¡œì§ ---
    function openModal(report) {
        const modal = document.getElementById('reportModal');
        const contentDiv = document.getElementById('modalContent');
        const titleDiv = document.getElementById('modalTitle');

        modal.style.display = 'flex';

        const dt = formatDateTime(report.SK);
        titleDiv.innerHTML = `ğŸ“„ <b>${dt.date} ${dt.time}</b> ë³´ê³ ì„œ`;

        let rawContent = report.Content || report.content;

        if (!rawContent) {
            contentDiv.innerHTML = '<p style="color:#888; text-align:center;">ë‚´ìš©ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
        } else {
            contentDiv.innerHTML = marked.parse(rawContent);
        }
    }

    function closeModal() {
        document.getElementById('reportModal').style.display = 'none';
    }

    window.onclick = function(event) {
        const modal = document.getElementById('reportModal');
        if (event.target == modal) {
            closeModal();
        }
    }

    document.addEventListener("DOMContentLoaded", loadReports);
</script>
<script src="js/header.js"></script>
</body>
</html>