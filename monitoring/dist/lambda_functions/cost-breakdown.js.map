{"version":3,"file":"cost-breakdown.js","sourceRoot":"","sources":["../../lambda_functions/cost-breakdown.ts"],"names":[],"mappings":"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","sourcesContent":["// lambda_functions/cost-breakdown.ts\nimport { APIGatewayProxyHandler } from 'aws-lambda';\nimport * as AWS from 'aws-sdk';\n\n// AWS SDK 클라이언트 초기화\nconst costExplorer = new AWS.CostExplorer({ region: 'us-east-1' }); // Cost Explorer는 us-east-1 리전 사용\nconst pricing = new AWS.Pricing({ region: 'us-east-1' });\n\n/**\n * GitNote Cost Breakdown Lambda Handler\n * AWS 서비스별 비용을 분석하고 최적화 제안을 제공\n */\nexport const handler: APIGatewayProxyHandler = async (event) => {\n    console.log('Cost Breakdown Request:', JSON.stringify(event));\n    \n    try {\n        // 현재 및 이전 달 비용 조회\n        const costData = await getMonthlyServiceCosts();\n        \n        // 일별 비용 추이 조회\n        const dailyCosts = await getDailyCostTrend();\n        \n        // 예상 비용 계산\n        const forecast = await getCostForecast();\n        \n        // 비용 최적화 제안\n        const recommendations = await getCostOptimizationRecommendations();\n        \n        // 이상 징후 감지\n        const alerts = detectCostAnomalies(costData, dailyCosts);\n        \n        // 응답 구성\n        const response = {\n            services: costData.services,\n            breakdown: costData.breakdown,\n            totalCost: costData.totalCurrentMonth,\n            lastMonthCost: costData.totalLastMonth,\n            costTrend: costData.percentageChange,\n            dailyTrend: dailyCosts,\n            forecast,\n            recommendations,\n            alerts,\n            timestamp: new Date().toISOString()\n        };\n        \n        return {\n            statusCode: 200,\n            headers: {\n                'Content-Type': 'application/json',\n                'Access-Control-Allow-Origin': '*',\n                'Access-Control-Allow-Headers': 'Content-Type',\n                'Access-Control-Allow-Methods': 'GET, OPTIONS'\n            },\n            body: JSON.stringify(response)\n        };\n        \n    } catch (error) {\n        console.error('Error in cost-breakdown handler:', error);\n        \n        // Cost Explorer API 권한이 없는 경우 시뮬레이션 데이터 반환\n        if ((error as any).code === 'AccessDeniedException') {\n            return {\n                statusCode: 200,\n                headers: {\n                    'Content-Type': 'application/json',\n                    'Access-Control-Allow-Origin': '*'\n                },\n                body: JSON.stringify(getSimulatedCostData())\n            };\n        }\n        \n        return {\n            statusCode: 500,\n            headers: {\n                'Content-Type': 'application/json',\n                'Access-Control-Allow-Origin': '*'\n            },\n            body: JSON.stringify({\n                error: 'Failed to retrieve cost breakdown',\n                message: error instanceof Error ? error.message : 'Unknown error',\n                timestamp: new Date().toISOString()\n            })\n        };\n    }\n};\n\n/**\n * 월별 서비스 비용 조회\n */\nasync function getMonthlyServiceCosts(): Promise<any> {\n    const now = new Date();\n    const currentMonthStart = new Date(now.getFullYear(), now.getMonth(), 1).toISOString().split('T')[0];\n    const currentMonthEnd = new Date(now.getFullYear(), now.getMonth() + 1, 0).toISOString().split('T')[0];\n    const lastMonthStart = new Date(now.getFullYear(), now.getMonth() - 1, 1).toISOString().split('T')[0];\n    const lastMonthEnd = new Date(now.getFullYear(), now.getMonth(), 0).toISOString().split('T')[0];\n    \n    const result = {\n        services: [] as any[],\n        breakdown: {} as any,\n        totalCurrentMonth: 0,\n        totalLastMonth: 0,\n        percentageChange: 0\n    };\n    \n    try {\n        // 현재 달 비용 조회\n        const currentMonthResponse = await costExplorer.getCostAndUsage({\n            TimePeriod: {\n                Start: currentMonthStart,\n                End: currentMonthEnd\n            },\n            Granularity: 'MONTHLY',\n            Metrics: ['UnblendedCost'],\n            GroupBy: [\n                {\n                    Type: 'DIMENSION',\n                    Key: 'SERVICE'\n                }\n            ],\n            Filter: {\n                Dimensions: {\n                    Key: 'LINKED_ACCOUNT',\n                    Values: ['061039804626'] // 실제 계정 ID\n                }\n            }\n        }).promise();\n        \n        // 이전 달 비용 조회\n        const lastMonthResponse = await costExplorer.getCostAndUsage({\n            TimePeriod: {\n                Start: lastMonthStart,\n                End: lastMonthEnd\n            },\n            Granularity: 'MONTHLY',\n            Metrics: ['UnblendedCost'],\n            GroupBy: [\n                {\n                    Type: 'DIMENSION',\n                    Key: 'SERVICE'\n                }\n            ],\n            Filter: {\n                Dimensions: {\n                    Key: 'LINKED_ACCOUNT',\n                    Values: ['061039804626'] // 실제 계정 ID\n                }\n            }\n        }).promise();\n        \n        // 서비스별 비용 매핑\n        const currentCosts = new Map<string, number>();\n        const lastCosts = new Map<string, number>();\n        \n        if (currentMonthResponse.ResultsByTime && currentMonthResponse.ResultsByTime[0]) {\n            currentMonthResponse.ResultsByTime[0].Groups?.forEach(group => {\n                const serviceName = mapServiceName(group.Keys?.[0] || 'Unknown');\n                const cost = parseFloat(group.Metrics?.UnblendedCost?.Amount || '0');\n                currentCosts.set(serviceName, cost);\n                result.totalCurrentMonth += cost;\n            });\n        }\n        \n        if (lastMonthResponse.ResultsByTime && lastMonthResponse.ResultsByTime[0]) {\n            lastMonthResponse.ResultsByTime[0].Groups?.forEach(group => {\n                const serviceName = mapServiceName(group.Keys?.[0] || 'Unknown');\n                const cost = parseFloat(group.Metrics?.UnblendedCost?.Amount || '0');\n                lastCosts.set(serviceName, cost);\n                result.totalLastMonth += cost;\n            });\n        }\n        \n        // GitNote 관련 주요 서비스만 필터링\n        const relevantServices = [\n            'EC2 - Other',\n            'Amazon Elastic Container Service',\n            'Amazon Simple Storage Service',\n            'Amazon DynamoDB',\n            'AWS Lambda',\n            'Amazon CloudWatch',\n            'Amazon Elastic Load Balancing',\n            'AWS Secrets Manager',\n            'Amazon Route 53',\n            'AWS CloudTrail'\n        ];\n        \n        relevantServices.forEach(service => {\n            const currentCost = currentCosts.get(service) || 0;\n            const lastCost = lastCosts.get(service) || 0;\n            \n            if (currentCost > 0 || lastCost > 0) {\n                const change = lastCost > 0 \n                    ? ((currentCost - lastCost) / lastCost) * 100 \n                    : currentCost > 0 ? 100 : 0;\n                \n                result.services.push({\n                    name: service,\n                    currentMonth: currentCost,\n                    lastMonth: lastCost,\n                    change: change\n                });\n                \n                result.breakdown[service] = currentCost;\n            }\n        });\n        \n        // 전체 비용 변화율 계산\n        result.percentageChange = result.totalLastMonth > 0\n            ? ((result.totalCurrentMonth - result.totalLastMonth) / result.totalLastMonth) * 100\n            : 0;\n        \n    } catch (error) {\n        console.error('Error getting monthly service costs:', error);\n        throw error;\n    }\n    \n    return result;\n}\n\n/**\n * 일별 비용 추이 조회\n */\nasync function getDailyCostTrend(): Promise<any[]> {\n    const trend: any[] = [];\n    const endDate = new Date();\n    const startDate = new Date();\n    startDate.setDate(startDate.getDate() - 7); // 최근 7일\n    \n    try {\n        const response = await costExplorer.getCostAndUsage({\n            TimePeriod: {\n                Start: startDate.toISOString().split('T')[0],\n                End: endDate.toISOString().split('T')[0]\n            },\n            Granularity: 'DAILY',\n            Metrics: ['UnblendedCost']\n        }).promise();\n        \n        response.ResultsByTime?.forEach(day => {\n            trend.push({\n                date: day.TimePeriod?.Start,\n                cost: parseFloat(day.Total?.UnblendedCost?.Amount || '0')\n            });\n        });\n        \n    } catch (error) {\n        console.error('Error getting daily cost trend:', error);\n    }\n    \n    return trend;\n}\n\n/**\n * 비용 예측\n */\nasync function getCostForecast(): Promise<any> {\n    const forecast = {\n        nextMonth: 0,\n        endOfMonth: 0,\n        confidence: 0\n    };\n    \n    try {\n        const startDate = new Date();\n        const endDate = new Date();\n        endDate.setMonth(endDate.getMonth() + 1);\n        \n        const response = await costExplorer.getCostForecast({\n            TimePeriod: {\n                Start: startDate.toISOString().split('T')[0],\n                End: endDate.toISOString().split('T')[0]\n            },\n            Metric: 'UNBLENDED_COST',\n            Granularity: 'MONTHLY',\n            PredictionIntervalLevel: 80\n        }).promise();\n        \n        if (response.Total) {\n            forecast.nextMonth = parseFloat(response.Total.Amount || '0');\n        }\n        \n    } catch (error) {\n        console.error('Error getting cost forecast:', error);\n        \n        // 예측 API가 실패한 경우 간단한 추정\n        // 현재 비용 추세를 기반으로 계산\n        forecast.nextMonth = 450; // 예시 값\n    }\n    \n    return forecast;\n}\n\n/**\n * 비용 최적화 제안\n */\nasync function getCostOptimizationRecommendations(): Promise<any[]> {\n    const recommendations: any[] = [];\n    \n    // 정적 추천사항 (실제로는 리소스 분석 기반으로 동적 생성)\n    recommendations.push({\n        service: 'ECS Fargate',\n        recommendation: 'Use Fargate Spot for development environment',\n        estimatedSavings: 45,\n        impact: 'low',\n        difficulty: 'easy'\n    });\n    \n    recommendations.push({\n        service: 'S3',\n        recommendation: 'Enable S3 Intelligent-Tiering for infrequently accessed data',\n        estimatedSavings: 8,\n        impact: 'none',\n        difficulty: 'easy'\n    });\n    \n    recommendations.push({\n        service: 'DynamoDB',\n        recommendation: 'Switch to On-Demand pricing for variable workloads',\n        estimatedSavings: 23,\n        impact: 'medium',\n        difficulty: 'medium'\n    });\n    \n    recommendations.push({\n        service: 'NAT Gateway',\n        recommendation: 'Consider NAT Instance for dev environment',\n        estimatedSavings: 30,\n        impact: 'low',\n        difficulty: 'hard'\n    });\n    \n    recommendations.push({\n        service: 'CloudWatch',\n        recommendation: 'Reduce log retention period to 7 days for non-critical logs',\n        estimatedSavings: 5,\n        impact: 'low',\n        difficulty: 'easy'\n    });\n    \n    return recommendations;\n}\n\n/**\n * 비용 이상 징후 감지\n */\nfunction detectCostAnomalies(costData: any, dailyCosts: any[]): any[] {\n    const alerts: any[] = [];\n    \n    // 월간 비용 급증 감지\n    if (costData.percentageChange > 20) {\n        alerts.push({\n            severity: 'warning',\n            title: 'Significant Cost Increase',\n            message: `Monthly costs increased by ${costData.percentageChange.toFixed(1)}% compared to last month.`,\n            timestamp: new Date().toISOString()\n        });\n    }\n    \n    // 특정 서비스 비용 급증\n    costData.services.forEach((service: any) => {\n        if (service.change > 50 && service.currentMonth > 10) {\n            alerts.push({\n                severity: service.change > 100 ? 'danger' : 'warning',\n                title: `${service.name} Cost Spike`,\n                message: `${service.name} costs increased by ${service.change.toFixed(1)}% ($${(service.currentMonth - service.lastMonth).toFixed(2)}).`,\n                timestamp: new Date().toISOString()\n            });\n        }\n    });\n    \n    // DynamoDB 비용 특별 모니터링\n    const dynamoService = costData.services.find((s: any) => s.name.includes('DynamoDB'));\n    if (dynamoService && dynamoService.currentMonth > 100) {\n        alerts.push({\n            severity: 'warning',\n            title: 'High DynamoDB Costs',\n            message: `DynamoDB costs are $${dynamoService.currentMonth.toFixed(2)}. Consider reviewing table capacity settings.`,\n            timestamp: new Date().toISOString()\n        });\n    }\n    \n    // 일일 비용 급증 감지\n    if (dailyCosts.length > 1) {\n        const avgDailyCost = dailyCosts.reduce((sum, day) => sum + day.cost, 0) / dailyCosts.length;\n        const lastDay = dailyCosts[dailyCosts.length - 1];\n        \n        if (lastDay && lastDay.cost > avgDailyCost * 1.5) {\n            alerts.push({\n                severity: 'warning',\n                title: 'Daily Cost Spike',\n                message: `Today's costs ($${lastDay.cost.toFixed(2)}) are 50% higher than the weekly average.`,\n                timestamp: new Date().toISOString()\n            });\n        }\n    }\n    \n    // 예상 비용 임계값 초과\n    if (costData.totalCurrentMonth > 500) {\n        alerts.push({\n            severity: 'info',\n            title: 'Budget Threshold Approaching',\n            message: `Current month costs ($${costData.totalCurrentMonth.toFixed(2)}) approaching $500 threshold.`,\n            timestamp: new Date().toISOString()\n        });\n    }\n    \n    return alerts;\n}\n\n/**\n * AWS 서비스명 매핑\n */\nfunction mapServiceName(awsServiceName: string): string {\n    const serviceMap: { [key: string]: string } = {\n        'AmazonEC2': 'EC2 - Other',\n        'AmazonECS': 'Amazon Elastic Container Service',\n        'AmazonS3': 'Amazon Simple Storage Service',\n        'AmazonDynamoDB': 'Amazon DynamoDB',\n        'AWSLambda': 'AWS Lambda',\n        'AmazonCloudWatch': 'Amazon CloudWatch',\n        'ElasticLoadBalancing': 'Amazon Elastic Load Balancing',\n        'AmazonRoute53': 'Amazon Route 53',\n        'AWSSecretsManager': 'AWS Secrets Manager',\n        'AmazonCloudFront': 'Amazon CloudFront',\n        'AWSCloudTrail': 'AWS CloudTrail'\n    };\n    \n    return serviceMap[awsServiceName] || awsServiceName;\n}\n\n/**\n * Cost Explorer API 권한이 없을 때 시뮬레이션 데이터 반환\n */\nfunction getSimulatedCostData(): any {\n    // GitNote 프로젝트의 예상 비용 구조\n    const services = [\n        { name: 'ECS Fargate', currentMonth: 182.45, lastMonth: 165.32, change: 10.3 },\n        { name: 'Application Load Balancer', currentMonth: 45.20, lastMonth: 44.80, change: 0.9 },\n        { name: 'NAT Gateway', currentMonth: 67.80, lastMonth: 68.10, change: -0.4 },\n        { name: 'S3 Storage', currentMonth: 12.34, lastMonth: 10.89, change: 13.3 },\n        { name: 'DynamoDB', currentMonth: 89.23, lastMonth: 72.15, change: 23.7 },\n        { name: 'CloudWatch', currentMonth: 18.92, lastMonth: 17.65, change: 7.2 },\n        { name: 'Lambda', currentMonth: 3.45, lastMonth: 3.12, change: 10.6 },\n        { name: 'Secrets Manager', currentMonth: 0.40, lastMonth: 0.40, change: 0 },\n        { name: 'Route 53', currentMonth: 2.15, lastMonth: 2.15, change: 0 }\n    ];\n    \n    const totalCurrentMonth = services.reduce((sum, s) => sum + s.currentMonth, 0);\n    const totalLastMonth = services.reduce((sum, s) => sum + s.lastMonth, 0);\n    \n    const breakdown: any = {};\n    services.forEach(s => {\n        breakdown[s.name] = s.currentMonth;\n    });\n    \n    // 일별 비용 추이 (최근 7일)\n    const dailyTrend = [];\n    for (let i = 6; i >= 0; i--) {\n        const date = new Date();\n        date.setDate(date.getDate() - i);\n        dailyTrend.push({\n            date: date.toISOString().split('T')[0],\n            cost: 13 + Math.random() * 4\n        });\n    }\n    \n    return {\n        services,\n        breakdown,\n        totalCost: totalCurrentMonth,\n        lastMonthCost: totalLastMonth,\n        costTrend: ((totalCurrentMonth - totalLastMonth) / totalLastMonth) * 100,\n        dailyTrend,\n        forecast: {\n            nextMonth: totalCurrentMonth * 1.05,\n            endOfMonth: totalCurrentMonth * 1.03,\n            confidence: 80\n        },\n        recommendations: [\n            {\n                service: 'ECS Fargate',\n                recommendation: 'Use Fargate Spot for development',\n                estimatedSavings: 45,\n                impact: 'low'\n            },\n            {\n                service: 'DynamoDB',\n                recommendation: 'Optimize read/write capacity',\n                estimatedSavings: 23,\n                impact: 'medium'\n            }\n        ],\n        alerts: [\n            {\n                severity: 'warning',\n                title: 'DynamoDB Cost Increase',\n                message: 'DynamoDB costs increased by 23.7% compared to last month.',\n                timestamp: new Date().toISOString()\n            }\n        ],\n        timestamp: new Date().toISOString()\n    };\n}"]}