{"version":3,"file":"storage-health.js","sourceRoot":"","sources":["../../lambda_functions/storage-health.ts"],"names":[],"mappings":"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","sourcesContent":["// lambda_functions/storage-health.ts\nimport { APIGatewayProxyHandler } from 'aws-lambda';\nimport * as AWS from 'aws-sdk';\n\n// AWS SDK 클라이언트 초기화\nconst s3 = new AWS.S3({ region: 'ap-northeast-2' });\nconst dynamodb = new AWS.DynamoDB({ region: 'ap-northeast-2' });\nconst cloudwatch = new AWS.CloudWatch({ region: 'ap-northeast-2' });\n\n/**\n * GitNote Storage Health Lambda Handler\n * S3 버킷과 DynamoDB 테이블의 상태 및 성능을 모니터링\n */\nexport const handler: APIGatewayProxyHandler = async (event) => {\n    console.log('Storage Health Request:', JSON.stringify(event));\n    \n    try {\n        // S3 버킷 상태 조회\n        const s3Status = await getS3BucketStatus();\n        \n        // DynamoDB 테이블 상태 조회\n        const dynamoStatus = await getDynamoDBStatus();\n        \n        // 스토리지 메트릭 조회\n        const storageMetrics = await getStorageMetrics();\n        \n        // 이상 징후 감지\n        const alerts = detectStorageIssues(s3Status, dynamoStatus, storageMetrics);\n        \n        // 응답 구성\n        const response = {\n            storage: [\n                ...s3Status,\n                ...dynamoStatus\n            ],\n            metrics: storageMetrics,\n            alerts,\n            timestamp: new Date().toISOString()\n        };\n        \n        return {\n            statusCode: 200,\n            headers: {\n                'Content-Type': 'application/json',\n                'Access-Control-Allow-Origin': '*',\n                'Access-Control-Allow-Headers': 'Content-Type',\n                'Access-Control-Allow-Methods': 'GET, OPTIONS'\n            },\n            body: JSON.stringify(response)\n        };\n        \n    } catch (error) {\n        console.error('Error in storage-health handler:', error);\n        \n        return {\n            statusCode: 500,\n            headers: {\n                'Content-Type': 'application/json',\n                'Access-Control-Allow-Origin': '*'\n            },\n            body: JSON.stringify({\n                error: 'Failed to retrieve storage health',\n                message: error instanceof Error ? error.message : 'Unknown error',\n                timestamp: new Date().toISOString()\n            })\n        };\n    }\n};\n\n/**\n * S3 버킷 상태 및 메트릭 조회\n */\nasync function getS3BucketStatus(): Promise<any[]> {\n    const buckets: any[] = [];\n    const bucketName = 'gitnote-s3-bucket';\n    \n    try {\n        // 버킷 존재 확인\n        await s3.headBucket({ Bucket: bucketName }).promise();\n        \n        // 버킷 버저닝 상태\n        let versioningStatus = 'Disabled';\n        try {\n            const versioning = await s3.getBucketVersioning({ Bucket: bucketName }).promise();\n            versioningStatus = versioning.Status || 'Disabled';\n        } catch (error) {\n            console.error('Error getting versioning status:', error);\n        }\n        \n        // 버킷 암호화 상태\n        let encryptionStatus = 'Disabled';\n        try {\n            await s3.getBucketEncryption({ Bucket: bucketName }).promise();\n            encryptionStatus = 'Enabled';\n        } catch (error) {\n            if ((error as any).code === 'ServerSideEncryptionConfigurationNotFoundError') {\n                encryptionStatus = 'Disabled';\n            }\n        }\n        \n        // 버킷 크기 및 객체 수 (CloudWatch 메트릭)\n        const bucketSize = await getS3BucketSize(bucketName);\n        const objectCount = await getS3ObjectCount(bucketName);\n        \n        // 버킷 라이프사이클 정책\n        let lifecycleStatus = 'Not Configured';\n        try {\n            const lifecycle = await s3.getBucketLifecycleConfiguration({ Bucket: bucketName }).promise();\n            if (lifecycle.Rules && lifecycle.Rules.length > 0) {\n                lifecycleStatus = `${lifecycle.Rules.length} rules configured`;\n            }\n        } catch (error) {\n            if ((error as any).code !== 'NoSuchLifecycleConfiguration') {\n                console.error('Error getting lifecycle:', error);\n            }\n        }\n        \n        // 버킷 액세스 로깅\n        let loggingStatus = 'Disabled';\n        try {\n            const logging = await s3.getBucketLogging({ Bucket: bucketName }).promise();\n            if (logging.LoggingEnabled) {\n                loggingStatus = 'Enabled';\n            }\n        } catch (error) {\n            console.error('Error getting logging status:', error);\n        }\n        \n        buckets.push({\n            name: bucketName,\n            type: 'S3',\n            status: 'healthy',\n            size: bucketSize,\n            itemCount: objectCount,\n            details: {\n                'Versioning': versioningStatus,\n                'Encryption': encryptionStatus,\n                'Lifecycle': lifecycleStatus,\n                'Access Logging': loggingStatus,\n                'Region': 'ap-northeast-2'\n            },\n            metrics: {\n                'Storage Size': formatBytes(bucketSize),\n                'Object Count': objectCount.toLocaleString(),\n                'Avg Object Size': objectCount > 0 ? formatBytes(bucketSize / objectCount) : '0 B'\n            }\n        });\n        \n    } catch (error) {\n        console.error('Error getting S3 bucket status:', error);\n        \n        if ((error as any).code === 'NotFound' || (error as any).code === 'NoSuchBucket') {\n            buckets.push({\n                name: bucketName,\n                type: 'S3',\n                status: 'critical',\n                size: 0,\n                itemCount: 0,\n                error: 'Bucket not found'\n            });\n        } else {\n            buckets.push({\n                name: bucketName,\n                type: 'S3',\n                status: 'critical',\n                size: 0,\n                itemCount: 0,\n                error: 'Failed to retrieve bucket information'\n            });\n        }\n    }\n    \n    return buckets;\n}\n\n/**\n * DynamoDB 테이블 상태 및 메트릭 조회\n */\nasync function getDynamoDBStatus(): Promise<any[]> {\n    const tables: any[] = [];\n    const tableNames = ['UserPreset', 'UserReports'];\n    \n    for (const tableName of tableNames) {\n        try {\n            // 테이블 상태 조회\n            const tableInfo = await dynamodb.describeTable({ TableName: tableName }).promise();\n            \n            if (tableInfo.Table) {\n                const table = tableInfo.Table;\n                \n                // CloudWatch 메트릭 조회 (throttles, consumed capacity)\n                const throttleMetrics = await getDynamoDBThrottles(tableName);\n                const consumedCapacity = await getDynamoDBConsumedCapacity(tableName);\n                \n                // 테이블 상태 판단\n                const status = table.TableStatus === 'ACTIVE' && throttleMetrics.readThrottles === 0 && throttleMetrics.writeThrottles === 0 \n                    ? 'healthy' \n                    : throttleMetrics.readThrottles > 0 || throttleMetrics.writeThrottles > 0 \n                    ? 'warning' \n                    : 'degraded';\n                \n                tables.push({\n                    name: tableName,\n                    type: 'DynamoDB',\n                    status,\n                    size: table.TableSizeBytes || 0,\n                    itemCount: table.ItemCount || 0,\n                    throttles: throttleMetrics.readThrottles + throttleMetrics.writeThrottles,\n                    details: {\n                        'Table Status': table.TableStatus,\n                        'Billing Mode': table.BillingModeSummary?.BillingMode || 'PROVISIONED',\n                        'Read Capacity': table.ProvisionedThroughput?.ReadCapacityUnits || 'On-Demand',\n                        'Write Capacity': table.ProvisionedThroughput?.WriteCapacityUnits || 'On-Demand',\n                        'Indexes': table.GlobalSecondaryIndexes?.length || 0,\n                        'Streams': table.StreamSpecification?.StreamEnabled ? 'Enabled' : 'Disabled'\n                    },\n                    metrics: {\n                        'Item Count': (table.ItemCount || 0).toLocaleString(),\n                        'Table Size': formatBytes(table.TableSizeBytes || 0),\n                        'Read Throttles': throttleMetrics.readThrottles,\n                        'Write Throttles': throttleMetrics.writeThrottles,\n                        'Consumed RCU': consumedCapacity.readCapacity.toFixed(2),\n                        'Consumed WCU': consumedCapacity.writeCapacity.toFixed(2)\n                    }\n                });\n                \n                // Global Secondary Indexes 상태 확인\n                if (table.GlobalSecondaryIndexes) {\n                    for (const gsi of table.GlobalSecondaryIndexes) {\n                        if (gsi.IndexStatus !== 'ACTIVE') {\n                            tables.push({\n                                name: `${tableName}/${gsi.IndexName}`,\n                                type: 'DynamoDB GSI',\n                                status: 'warning',\n                                details: {\n                                    'Index Status': gsi.IndexStatus,\n                                    'Item Count': gsi.ItemCount || 0,\n                                    'Index Size': formatBytes(gsi.IndexSizeBytes || 0)\n                                }\n                            });\n                        }\n                    }\n                }\n            }\n            \n        } catch (error) {\n            console.error(`Error getting DynamoDB table ${tableName} status:`, error);\n            \n            if ((error as any).code === 'ResourceNotFoundException') {\n                tables.push({\n                    name: tableName,\n                    type: 'DynamoDB',\n                    status: 'critical',\n                    size: 0,\n                    itemCount: 0,\n                    error: 'Table not found'\n                });\n            } else {\n                tables.push({\n                    name: tableName,\n                    type: 'DynamoDB',\n                    status: 'critical',\n                    size: 0,\n                    itemCount: 0,\n                    error: 'Failed to retrieve table information'\n                });\n            }\n        }\n    }\n    \n    return tables;\n}\n\n/**\n * S3 버킷 크기 조회 (CloudWatch 메트릭)\n */\nasync function getS3BucketSize(bucketName: string): Promise<number> {\n    const endTime = new Date();\n    const startTime = new Date(endTime.getTime() - 86400000); // 24시간 전\n    \n    try {\n        const response = await cloudwatch.getMetricStatistics({\n            Namespace: 'AWS/S3',\n            MetricName: 'BucketSizeBytes',\n            Dimensions: [\n                { Name: 'BucketName', Value: bucketName },\n                { Name: 'StorageType', Value: 'StandardStorage' }\n            ],\n            StartTime: startTime,\n            EndTime: endTime,\n            Period: 86400,\n            Statistics: ['Average']\n        }).promise();\n        \n        if (response.Datapoints && response.Datapoints.length > 0) {\n            return response.Datapoints[0].Average || 0;\n        }\n    } catch (error) {\n        console.error('Error getting S3 bucket size:', error);\n    }\n    \n    return 0;\n}\n\n/**\n * S3 객체 수 조회 (CloudWatch 메트릭)\n */\nasync function getS3ObjectCount(bucketName: string): Promise<number> {\n    const endTime = new Date();\n    const startTime = new Date(endTime.getTime() - 86400000);\n    \n    try {\n        const response = await cloudwatch.getMetricStatistics({\n            Namespace: 'AWS/S3',\n            MetricName: 'NumberOfObjects',\n            Dimensions: [\n                { Name: 'BucketName', Value: bucketName },\n                { Name: 'StorageType', Value: 'AllStorageTypes' }\n            ],\n            StartTime: startTime,\n            EndTime: endTime,\n            Period: 86400,\n            Statistics: ['Average']\n        }).promise();\n        \n        if (response.Datapoints && response.Datapoints.length > 0) {\n            return Math.round(response.Datapoints[0].Average || 0);\n        }\n    } catch (error) {\n        console.error('Error getting S3 object count:', error);\n    }\n    \n    // 메트릭이 없는 경우 직접 카운트 (제한적)\n    try {\n        const objects = await s3.listObjectsV2({\n            Bucket: bucketName,\n            MaxKeys: 1000\n        }).promise();\n        \n        return objects.KeyCount || 0;\n    } catch (error) {\n        console.error('Error listing S3 objects:', error);\n    }\n    \n    return 0;\n}\n\n/**\n * DynamoDB Throttle 메트릭 조회\n */\nasync function getDynamoDBThrottles(tableName: string): Promise<{ readThrottles: number; writeThrottles: number }> {\n    const endTime = new Date();\n    const startTime = new Date(endTime.getTime() - 3600000); // 1시간 전\n    \n    let readThrottles = 0;\n    let writeThrottles = 0;\n    \n    try {\n        // Read Throttles\n        const readResponse = await cloudwatch.getMetricStatistics({\n            Namespace: 'AWS/DynamoDB',\n            MetricName: 'ReadThrottleEvents',\n            Dimensions: [{ Name: 'TableName', Value: tableName }],\n            StartTime: startTime,\n            EndTime: endTime,\n            Period: 3600,\n            Statistics: ['Sum']\n        }).promise();\n        \n        if (readResponse.Datapoints && readResponse.Datapoints.length > 0) {\n            readThrottles = readResponse.Datapoints[0].Sum || 0;\n        }\n        \n        // Write Throttles\n        const writeResponse = await cloudwatch.getMetricStatistics({\n            Namespace: 'AWS/DynamoDB',\n            MetricName: 'WriteThrottleEvents',\n            Dimensions: [{ Name: 'TableName', Value: tableName }],\n            StartTime: startTime,\n            EndTime: endTime,\n            Period: 3600,\n            Statistics: ['Sum']\n        }).promise();\n        \n        if (writeResponse.Datapoints && writeResponse.Datapoints.length > 0) {\n            writeThrottles = writeResponse.Datapoints[0].Sum || 0;\n        }\n        \n    } catch (error) {\n        console.error(`Error getting DynamoDB throttles for ${tableName}:`, error);\n    }\n    \n    return { readThrottles, writeThrottles };\n}\n\n/**\n * DynamoDB Consumed Capacity 조회\n */\nasync function getDynamoDBConsumedCapacity(tableName: string): Promise<{ readCapacity: number; writeCapacity: number }> {\n    const endTime = new Date();\n    const startTime = new Date(endTime.getTime() - 300000); // 5분 전\n    \n    let readCapacity = 0;\n    let writeCapacity = 0;\n    \n    try {\n        // Consumed Read Capacity\n        const readResponse = await cloudwatch.getMetricStatistics({\n            Namespace: 'AWS/DynamoDB',\n            MetricName: 'ConsumedReadCapacityUnits',\n            Dimensions: [{ Name: 'TableName', Value: tableName }],\n            StartTime: startTime,\n            EndTime: endTime,\n            Period: 300,\n            Statistics: ['Average']\n        }).promise();\n        \n        if (readResponse.Datapoints && readResponse.Datapoints.length > 0) {\n            readCapacity = readResponse.Datapoints[0].Average || 0;\n        }\n        \n        // Consumed Write Capacity\n        const writeResponse = await cloudwatch.getMetricStatistics({\n            Namespace: 'AWS/DynamoDB',\n            MetricName: 'ConsumedWriteCapacityUnits',\n            Dimensions: [{ Name: 'TableName', Value: tableName }],\n            StartTime: startTime,\n            EndTime: endTime,\n            Period: 300,\n            Statistics: ['Average']\n        }).promise();\n        \n        if (writeResponse.Datapoints && writeResponse.Datapoints.length > 0) {\n            writeCapacity = writeResponse.Datapoints[0].Average || 0;\n        }\n        \n    } catch (error) {\n        console.error(`Error getting DynamoDB consumed capacity for ${tableName}:`, error);\n    }\n    \n    return { readCapacity, writeCapacity };\n}\n\n/**\n * 전체 스토리지 메트릭 집계\n */\nasync function getStorageMetrics(): Promise<any> {\n    const metrics = {\n        totalStorageSize: 0,\n        totalObjectCount: 0,\n        totalDynamoDBItems: 0,\n        totalDynamoDBSize: 0,\n        s3RequestCount: 0,\n        dynamoDBRequestCount: 0\n    };\n    \n    // 이 정보는 위에서 수집한 데이터를 집계하여 반환\n    // 실제 구현에서는 캐싱을 고려해야 함\n    \n    return metrics;\n}\n\n/**\n * 스토리지 이상 징후 감지\n */\nfunction detectStorageIssues(s3Status: any[], dynamoStatus: any[], metrics: any): any[] {\n    const alerts: any[] = [];\n    \n    // S3 버킷 이슈 확인\n    s3Status.forEach(bucket => {\n        // 암호화 미설정\n        if (bucket.details && bucket.details['Encryption'] === 'Disabled') {\n            alerts.push({\n                severity: 'warning',\n                title: 'S3 Bucket Encryption Disabled',\n                message: `Bucket ${bucket.name} does not have encryption enabled. Enable SSE for security.`,\n                timestamp: new Date().toISOString()\n            });\n        }\n        \n        // 버저닝 미설정\n        if (bucket.details && bucket.details['Versioning'] === 'Disabled') {\n            alerts.push({\n                severity: 'info',\n                title: 'S3 Versioning Disabled',\n                message: `Consider enabling versioning for ${bucket.name} to protect against accidental deletion.`,\n                timestamp: new Date().toISOString()\n            });\n        }\n        \n        // 큰 버킷 크기\n        if (bucket.size > 10 * 1024 * 1024 * 1024) { // 10GB\n            alerts.push({\n                severity: 'info',\n                title: 'Large S3 Bucket',\n                message: `Bucket ${bucket.name} is ${formatBytes(bucket.size)}. Consider lifecycle policies for cost optimization.`,\n                timestamp: new Date().toISOString()\n            });\n        }\n    });\n    \n    // DynamoDB 테이블 이슈 확인\n    dynamoStatus.forEach(table => {\n        // Throttling 발생\n        if (table.throttles && table.throttles > 0) {\n            alerts.push({\n                severity: table.throttles > 10 ? 'danger' : 'warning',\n                title: 'DynamoDB Throttling Detected',\n                message: `Table ${table.name} experienced ${table.throttles} throttled requests. Consider increasing capacity or using on-demand mode.`,\n                timestamp: new Date().toISOString()\n            });\n        }\n        \n        // 테이블 상태 이상\n        if (table.details && table.details['Table Status'] !== 'ACTIVE') {\n            alerts.push({\n                severity: 'danger',\n                title: 'DynamoDB Table Not Active',\n                message: `Table ${table.name} is in ${table.details['Table Status']} state.`,\n                timestamp: new Date().toISOString()\n            });\n        }\n        \n        // 높은 consumed capacity (프로비전드 모드)\n        if (table.metrics && table.details?.['Billing Mode'] === 'PROVISIONED') {\n            const consumedRCU = parseFloat(table.metrics['Consumed RCU']);\n            const provisionedRCU = table.details['Read Capacity'];\n            \n            if (typeof provisionedRCU === 'number' && consumedRCU > provisionedRCU * 0.8) {\n                alerts.push({\n                    severity: 'warning',\n                    title: 'High DynamoDB Read Consumption',\n                    message: `Table ${table.name} is using ${consumedRCU}/${provisionedRCU} RCU (${((consumedRCU/provisionedRCU)*100).toFixed(1)}%).`,\n                    timestamp: new Date().toISOString()\n                });\n            }\n        }\n    });\n    \n    return alerts;\n}\n\n/**\n * 바이트를 읽기 쉬운 형식으로 변환\n */\nfunction formatBytes(bytes: number): string {\n    if (bytes === 0) return '0 B';\n    \n    const k = 1024;\n    const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    \n    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n}"]}